var i=window.EventCalendar;function r({view="dayGridMonth",locale="en",firstDay=1,dayMaxEvents=!1,eventContent=null,eventClickEnabled=!1,eventDragEnabled=!1,eventResizeEnabled=!1,noEventsClickEnabled=!1,dateClickEnabled=!1,dateSelectEnabled=!1,datesSetEnabled=!1,viewDidMountEnabled=!1,eventAllUpdatedEnabled=!1,hasDateClickContextMenu=null,hasDateSelectContextMenu=null,hasEventClickContextMenu=null,hasNoEventsClickContextMenu=null,resources=null,resourceLabelContent=null,theme=null,options={},eventAssetUrl}){return{init:function(){let e=this.mountCalendar();window.addEventListener("calendar--refresh",()=>{e.refetchEvents()}),this.$wire.on("calendar--set",t=>{e.setOption(t.key,t.value)})},mountCalendar:function(){return i.create(this.$el.querySelector("[data-calendar]"),this.getSettings())},getSettings:function(){let settings={view,locale,firstDay,dayMaxEvents,eventSources:[{events:e=>this.$wire.getEventsJs({...e,tzOffset:-new Date().getTimezoneOffset()})}],resources,selectable:dateSelectEnabled,eventStartEditable:eventDragEnabled,eventDurationEditable:eventResizeEnabled,dayCellFormat:e=>e.getDate().toString()};eventContent!==null&&(settings.eventContent=e=>{let t=e.event.extendedProps.model,n=eventContent[t]??eventContent._default;if(n===void 0)return;if(n&&!n.includes("{"))return{html:n};let s=n;if(typeof e.event.extendedProps=="object"){for(let a in e.event.extendedProps)if(a!=="model"){let l=new RegExp("{"+a+" }","g");s=s.replace(l,e.event.extendedProps[a]??"")}}return{html:s}}),resourceLabelContent!==null&&(settings.resourceLabelContent=e=>{let t=e.resource.extendedProps.model,n=resourceLabelContent[t]??resourceLabelContent._default;if(n!==void 0)return{html:this.wrapContent(n,e)}}),dateClickEnabled&&(settings.dateClick=e=>{let t={date:e.date,dateStr:e.dateStr,allDay:e.allDay,view:e.view,resource:e.resource,tzOffset:-new Date().getTimezoneOffset()};console.log("[calendar] dateClick",t),hasDateClickContextMenu?this.openContextMenu(e.jsEvent,t,"dateClick"):this.$wire.onDateClickJs(t)}),dateSelectEnabled&&(settings.select=e=>{let t={start:e.start,startStr:e.startStr,end:e.end,endStr:e.endStr,allDay:e.allDay,view:e.view,resource:e.resource,tzOffset:-new Date().getTimezoneOffset()};console.log("[calendar] dateSelect",t),hasDateSelectContextMenu?this.openContextMenu(e.jsEvent,t,"dateSelect"):this.$wire.onDateSelectJs(t)}),datesSetEnabled&&(settings.datesSet=e=>{this.$wire.onDatesSetJs({start:e.start,startStr:e.startStr,end:e.end,endStr:e.endStr,view:e.view,tzOffset:-new Date().getTimezoneOffset()})}),eventClickEnabled&&(settings.eventClick=e=>{try{console.log("[calendar] eventClick",e.event);let t=e.el||e.jsEvent&&e.jsEvent.target||null,n=null;if(t)try{n=Alpine.$data(t)}catch{}if(n&&typeof n.onClick=="function"){n.onClick(e);return}this.$wire.onEventClickJs({event:e.event,view:e.view,tzOffset:-new Date().getTimezoneOffset()})}catch(t){console.error("[calendar] eventClick handler error",t)}}),settings.eventResize=async e=>{let t=e.event.durationEditable,n=eventResizeEnabled;t!==void 0&&(n=t),n&&await this.$wire.onEventResizeJs({event:e.event,oldEvent:e.oldEvent,endDelta:e.endDelta,view:e.view,tzOffset:-new Date().getTimezoneOffset()}).then(s=>{s===!1&&e.revert()})},settings.eventDrop=async e=>{let t=e.event.startEditable,n=eventDragEnabled;t!==void 0&&(n=t),n&&await this.$wire.onEventDropJs({event:e.event,oldEvent:e.oldEvent,oldResource:e.oldResource,newResource:e.newResource,delta:e.delta,view:e.view,tzOffset:-new Date().getTimezoneOffset()}).then(s=>{s===!1&&e.revert()})},settings.eventDidMount=e=>{e.el.classList.contains("ec-preview")||(e.el.setAttribute("data-calendar-event","1"),e.el.setAttribute("x-load"),e.el.setAttribute("x-load-src",eventAssetUrl),e.el.setAttribute("x-data",`calendarEvent({
                    event: ${JSON.stringify(e.event)},
                    timeText: "${e.timeText??""}",
                    view: ${JSON.stringify(e.view)},
                    hasContextMenu: ${hasEventClickContextMenu},
                })`))},noEventsClickEnabled&&(settings.noEventsClick=e=>{let t={view:e.view,tzOffset:-new Date().getTimezoneOffset()};hasNoEventsClickContextMenu?this.openContextMenu(e.jsEvent,t,"noEventsClick"):this.$wire.onNoEventsClickJs(t)}),viewDidMountEnabled&&(settings.viewDidMount=e=>{this.$wire.onViewDidMountJs({view:e.view,tzOffset:-new Date().getTimezoneOffset()})}),eventAllUpdatedEnabled&&(settings.eventAllUpdated=e=>{this.$wire.onEventAllUpdatedJs({view:e.view,tzOffset:-new Date().getTimezoneOffset()})}),theme&&(settings.theme=function(e){return{...e,...theme}}),typeof options.dayRender=="string"&&(options.dayRender=eval("("+options.dayRender+")"));let finalSettings={...settings,...options};return console.debug("[calendar] Final settings",finalSettings),finalSettings},wrapContent:function(e,t){let n=document.createElement("div");return n.innerHTML=e,n.setAttribute("x-data",JSON.stringify(t)),n.classList.add("w-full"),n.outerHTML},openContextMenu:function(e,t,n){let s=document.querySelector("[calendar-context-menu]"),a=Alpine.$data(s);console.debug("[calendar] openContextMenu",n,t),a.loadActions(n,t),a.openMenu(e)}}}export{r as default};
